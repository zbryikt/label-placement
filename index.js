function import$(t,n){var e={}.hasOwnProperty;for(var r in n)e.call(n,r)&&(t[r]=n[r]);return t}$(document).ready(function(){var t,n,e,r,o,l,a;return t={label:{}},t.label.placement=function(){var t,n,e,r;return t={},n={},e=function(){var n,e,r,o,l,a,i,c,u,f,s;for(n=t.labels,n.map(function(t){return t.collide=!1}),t.nodes.map(function(t){return t.label.box=t.anchor.node.getBBox()}),e=!1,r=0,o=n.length;o>r;++r)for(l=r,a=l+1,i=n.length;i>a;++a)c=a,u=[n[l].box,n[c].box],f=u[0],s=u[1],s.x>f.x+f.width||s.x+s.width<f.x||s.y>f.y+f.height||s.y+s.height<f.y||(n[c].collide=!0,n[c].collideCount=(n[c].collideCount||0)+1,n[l].collide=!0,n[l].collideCount=(n[l].collideCount||0)+1,e=!0);return n.map(function(t){return t.collide?void 0:t.collideCount=0}),e},r=function(){var n,r,o,l;if(n=t.force.alpha(),e()){for(r=0,o=t.labels.length;o>r;++r)l=r,t.labels[l].x=t.anchors[l].x,t.labels[l].y>t.anchors[l].y&&(t.labels[l].y=t.anchors[l].y);t.force.charge(function(t){return t.collide?-280-10*t.collideCount:-60}),t.force.start(),t.force.alpha(n)}else.01>n&&t.force.stop();return t.tags.each(function(n,e){return n.offset={x:t.labels[e].x,y:t.labels[e].y}})},n.nodes=function(n){return t.tags=n,t.anchors=[],n.each(function(n){return t.anchors.push({x:n.x,y:n.y,fixed:!0,node:this})}),t.labels=t.anchors.map(function(t){return{x:t.x,y:t.y}}),t.nodes=t.anchors.map(function(n,e){return{anchor:t.anchors[e],label:t.labels[e]}}),t.pts=t.anchors.concat(t.labels),t.links=t.anchors.map(function(n,e){return{source:e,target:t.anchors.length+e}}),t.force=d3.layout.force().nodes(t.pts).links(t.links).linkDistance(10).linkStrength(.5).on("tick",r).size([400,300]).gravity(0).friction(.6),t.force.start()},n},n=d3.select("svg"),e=n[0][0].getBoundingClientRect().width,r=n[0][0].getBoundingClientRect().height,o=d3.range(20).map(function(){return{value:Math.round(10*Math.random())+1}}),o.map(function(t,n){return import$(t,{x:22*n+20,y:300-10*t.value,width:20,height:10*t.value})}),n.selectAll("rect").data(o).enter().append("rect").attr({x:function(t){return t.x},y:function(t){return t.y},width:function(t){return t.width},height:function(t){return t.height},fill:"#f99"}),l=n.selectAll("line").data(o).enter().append("line"),a=n.selectAll("text").data(o).enter().append("text").attr({x:function(t){return t.x+t.width/2},y:function(t){return t.y},"text-anchor":"middle",fill:"#000"}).text(function(t){return parseInt(t.value*Math.random()*1e3)}),t.label.placement().nodes(a),setInterval(function(){return l.attr({x1:function(t){return t.x+t.width/2},y1:function(t){return t.y},x2:function(t){return t.offset.x+t.width/2},y2:function(t){return t.offset.y},"stroke-width":1,stroke:"#000"}),a.attr({x:function(t){return t.offset.x+t.width/2},y:function(t){return t.offset.y}})},100)});